#!/bin/bash

#Obtain current directory
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

echo "Configuring webserver..."
# Configure webserver
if [ -e /etc/apache2/conf.d/ ]; then
	sudo a2enmod userdir >> $DIR/../../sitc.log 2>&1
	sudo a2enmod suexec >> $DIR/../../sitc.log 2>&1
	sudo cp /etc/apache2/mods-enabled/userdir.conf /etc/apache2/conf.d
	if [ ! -e /etc/apache2/conf.d/userdir.conf.orig ]; then
		sudo cp -p /etc/apache2/conf.d/userdir.conf /etc/apache2/conf.d/userdir.conf.orig
	fi
	sudo rm -f /etc/apache2/conf.d/userdir.conf
	sudo cp $DIR/../../patches/userdir.conf.dropin.deb7 /etc/apache2/conf.d/userdir.conf
elif [ -e /etc/apache2/mods-available/userdir.conf ]; then
	sudo a2enmod userdir >> $DIR/../../sitc.log 2>&1
	sudo a2enmod suexec >> $DIR/../../sitc.log 2>&1
	sudo a2enmod cgid >> $DIR/../../sitc.log 2>&1
	if [ ! -e /etc/apache2/mods-available/userdir.conf.orig ]; then
                sudo cp -p /etc/apache2/mods-available/userdir.conf /etc/apache2/mods-available/userdir.conf.orig
        fi
	sudo rm -f /etc/apache2/mods-available/userdir.conf
	sudo cp $DIR/../../patches/userdir.conf.dropin.deb8 /etc/apache2/mods-available/userdir.conf
fi
sudo service apache2 restart >> $DIR/../../sitc.log 2>&1
